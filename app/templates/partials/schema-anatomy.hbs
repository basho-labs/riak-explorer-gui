<div class="alert alert-info">The information below is pulled from "Planning Your Riak TS Table" in the <a href="http://docs.basho.com/riak/ts/1.2.0/using/planning/" target="_blank">Basho Docs</a></div>

<p>This page provides a basic overview of what you'll need and some guidelines/limitations. For a deeper dive into planning and designing Riak TS tables, check out <a target='_blank' href="http://docs.basho.com/riakts/1.2.0/learn-about/advancedplanning/">Advanced Planning</a>.</p>

<p>Riak TS tables are closely tied to SQL tables. If you are unfamiliar with SQL or would like to know more about how Riak TS integrates SQL, check out <a target='_blank' href="http://docs.basho.com/riakts/1.2.0/learn-about/sqlriakts/">SQL for Riak TS</a>.</p>

<h2>Anatomy of a Schema</h2>

<p>In order to create a working Riak TS table, you'll need to plan your table out. Once created, your table cannot be changed. Here is an example Riak TS <code>CREATE TABLE</code> statement (broken across many lines for clarity):</p>

<pre>CREATE TABLE GeoCheckin
(
   region       varchar   not null,
   state        varchar   not null,
   time         timestamp not null,
   weather      varchar   not null,
   temperature  double,
   PRIMARY KEY (
     (region, state, quantum(time, 15, 'm')),
     region, state, time
   )
)</pre>

<h4>Fields</h4>

<p>Fields, also called columns, refer to the items preceding the <code>PRIMARY KEY</code>. Field names (<code>region</code>, <code>state</code>, etc) must be ASCII strings, in addition to having the correct case. If field names need to contain spaces or punctuation they can be double quoted.</p>

<p>Field names define the structure of the data, taking the format:</p>

<pre>name type [not null],</pre>

<p>Fields specified as part of the primary key must be defined as <code>not null</code>.</p>

<p>The field definitions for the keys can be specified in any order in the <code>CREATE TABLE</code> statement. For instance both are correct:</p>

<p><strong>A.</strong></p>
<pre>CREATE TABLE GeoCheckin
(
   region       varchar   not null,
   state        varchar   not null,
   time         timestamp not null,
   weather      varchar not null,
   temperature  double,
   PRIMARY KEY (
     (region, state, quantum(time, 15, 'm')),
     region, state, time
   )
)</pre>

<p><strong>B.</strong></p>
<pre>CREATE TABLE GeoCheckin
(
   time         timestamp not null,
   state        varchar   not null,
   weather      varchar not null,
   region       varchar   not null,
   temperature  double,
   PRIMARY KEY (
     (quantum(time, 15, 'm'), state, region),
     time, state, region
   )
)</pre>

<p>The types associated with fields are limited. Valid types are:</p>

<ul>
  <li><code>varchar</code> - Any string content is valid, including Unicode. Can only be compared using strict equality, and will not be typecast (e.g., to an integer) for comparison purposes. Use single quotes to delimit varchar strings.</li>
  <li><code>boolean</code> - <code>true</code> or <code>false</code> (any case)</li>
  <li><code>timestamp</code> - Timestamps are integer values expressing <a target='_blank' href="https://en.wikipedia.org/wiki/Unix_time">UNIX epoch time in UTC</a> in <strong>milliseconds</strong>. Zero is not a valid timestamp.</li>
  <li><code>sint64</code> - Signed 64-bit integer</li>
  <li><code>double</code> - This type does not comply with its IEEE specification: <code>NaN</code> (not a number) and <code>INF</code> (infinity) cannot be used.</li>
</ul>

<h3>Primary Key</h3>

<p>The <code>PRIMARY KEY</code> describes both the partition and local keys. The partition key is a prefix of the local key, consisting of one or more fields. The local key must begin with the same fields as the partition key, but may have more fields.</p>

<pre>CREATE TABLE GeoCheckin
(
   time         timestamp not null,
   state        varchar   not null,
   weather      varchar not null,
   region       varchar   not null,
   temperature  double,
   PRIMARY KEY (
     (quantum(time, 15, 'm'), state, region),
     time, state, region
   )
)</pre>

<p>The field definitions for the <code>PRIMARY KEY</code> can be specified in any order in the <code>CREATE TABLE</code> statement. For instance both are correct:</p>

<p><strong>A.</strong></p>
<pre>CREATE TABLE GeoCheckin
(
   region       varchar   not null,
   state        varchar   not null,
   time         timestamp not null,
   weather      varchar not null,
   temperature  double,
   PRIMARY KEY (
     (region, state, quantum(time, 15, 'm')),
     region, state, time
   )
)</pre>

<p><strong>B.</strong></p>
<pre>CREATE TABLE GeoCheckin
(
   region       varchar   not null,
   state        varchar   not null,
   time         timestamp not null,
   weather      varchar not null,
   temperature  double,
   PRIMARY KEY (
     (state, region, quantum(time, 15, 'm')),
     state, region, time
   )
)</pre>

<h4>Partition Key</h4>

<p>The partition key is the first key, and is defined as the named fields in parentheses. The partition key must have <strong>at least one</strong> field</p>

<p>You can use a quantum to colocate data on one of the partition key's timestamp fields:</p>

<pre>PRIMARY KEY  (
  (region, state, quantum(time, 1, 's')),
  ...
)</pre>

<p>The timestamp field can occur at any point in the partition key. For example, this is snippet is also valid:</p>

<pre>PRIMARY KEY (
  (quantum(time, 1, 's'), region, state),
  ...
)</pre>

<p>The quantum function takes 3 parameters:</p>

<ul>
  <li>the name of a field in the table definition of type <code>timestamp</code></li>
  <li>a quantity</li>
  <li>a unit of time:
    <ul><li>'d'  - days</li>
      <li>'h' - hours</li>
      <li>'m' - minutes</li>
      <li>'s' - seconds</li></ul></li>
</ul>

<p>There may only be one quantum in the partition key.</p>

<p>The partition key can optionally quantize a timestamp field, sending all records for that quanta to the same vnodes:</p>

<h4>Local Key</h4>

<p>The local key comes after the partition key. It <strong>must first contain the same fields in the same order</strong> as the partition key. This ensures that the same fields determining your data's partition also dictate the sorting of the data within that partition.</p>

<p>The local key may also contain additional fields so long as they come after the fields present in the partition key.</p>

<pre>PRIMARY KEY (
  (region, state, quantum(time, 15, 'm')),
  region, state, time, latitude, longitude
)</pre>

<h2>Schema Discovery</h2>

<p>After creating a table, its schema can be discovered with the <code>DESCRIBE</code> statement, which will return, for each column, the following items:</p>

<ul>
  <li><em>Column</em>, field name;</li>
  <li><em>Type</em>, field type;</li>
  <li><em>Is Null</em>, <em>true</em> is the field is optional, <em>false</em> otherwise;</li>
  <li><em>Primary Key</em>, position of this field in the primary key, or blank if it does not appear in the key;</li>
  <li><em>Local Key</em>, position of this field in the local key, or blank if it does not appear in the key.</li>
</ul>

<pre>DESCRIBE GeoCheckin</pre>

<h2>More information</h2>

<p>Still unsure how best to structure your Riak TS table? Check out our <a target='_blank' href="http://docs.basho.com/riakts/1.2.0/learn-about/bestpractices/">best practice recommendations</a>.</p>

<p>Confused about columns, primary key, etc? Check out <a target='_blank' href="http://docs.basho.com/riakts/1.2.0/learn-about/advancedplanning/">Advanced Planning</a> for full definitions.</p>
